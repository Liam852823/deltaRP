<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Deltarune Soul Dodge</title>
<style>
  body {
    margin: 0; 
    background: #111;
    overflow: hidden;
    display: flex; 
    justify-content: center; 
    align-items: center;
    height: 100vh;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
  }
  canvas {
    background: #222;
    border: 4px solid #e03e3e;
    border-radius: 12px;
    display: block;
  }
  #info {
    position: fixed;
    top: 10px; left: 50%;
    transform: translateX(-50%);
    font-size: 18px;
    text-align: center;
  }
  #game-over {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    color: #e03e3e;
    font-size: 48px;
    font-weight: bold;
    display: none;
  }
  #restart-btn {
    position: fixed;
    top: 60%; left: 50%;
    transform: translateX(-50%);
    padding: 12px 24px;
    font-size: 20px;
    cursor: pointer;
    background: #e03e3e;
    border: none;
    border-radius: 8px;
    color: #111;
    display: none;
  }
</style>
</head>
<body>

<div id="info">Use arrow keys or WASD to move the soul. Dodge the damn bullets for as long as you fucking can!</div>
<canvas id="game" width="600" height="600"></canvas>
<div id="game-over">YOU FUCKING DIED</div>
<button id="restart-btn">Restart</button>

<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const info = document.getElementById('info');
  const gameOverText = document.getElementById('game-over');
  const restartBtn = document.getElementById('restart-btn');

  const width = canvas.width;
  const height = canvas.height;

  // Player (Soul) properties
  const soul = {
    x: width / 2,
    y: height / 2,
    radius: 15,
    speed: 5,
    dx: 0,
    dy: 0,
  };

  // Bullets array
  let bullets = [];
  let bulletSpeed = 3;
  let spawnInterval = 1000; // ms, will get faster
  let lastSpawn = 0;

  let lastTime = 0;
  let gameOver = false;
  let survivalTime = 0;

  // Control state
  const keys = {};

  // Event listeners for controls
  window.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
  });
  window.addEventListener('keyup', e => {
    keys[e.key.toLowerCase()] = false;
  });

  restartBtn.addEventListener('click', () => {
    resetGame();
  });

  function resetGame() {
    gameOver = false;
    bullets = [];
    soul.x = width / 2;
    soul.y = height / 2;
    survivalTime = 0;
    bulletSpeed = 3;
    spawnInterval = 1000;
    lastSpawn = 0;
    lastTime = performance.now();
    gameOverText.style.display = 'none';
    restartBtn.style.display = 'none';
    info.textContent = 'Use arrow keys or WASD to move the soul. Dodge the damn bullets for as long as you fucking can!';
    requestAnimationFrame(gameLoop);
  }

  function spawnBullet() {
    // Bullets spawn from random edge, heading towards soul with some randomness

    const edges = ['top', 'right', 'bottom', 'left'];
    const edge = edges[Math.floor(Math.random() * edges.length)];

    let x, y, targetX, targetY;
    targetX = soul.x + (Math.random() * 100 - 50); // slight aim randomness
    targetY = soul.y + (Math.random() * 100 - 50);

    switch(edge){
      case 'top':
        x = Math.random() * width;
        y = -20;
        break;
      case 'right':
        x = width + 20;
        y = Math.random() * height;
        break;
      case 'bottom':
        x = Math.random() * width;
        y = height + 20;
        break;
      case 'left':
        x = -20;
        y = Math.random() * height;
        break;
    }

    // Calculate velocity vector
    const angle = Math.atan2(targetY - y, targetX - x);
    const vx = Math.cos(angle) * bulletSpeed;
    const vy = Math.sin(angle) * bulletSpeed;

    bullets.push({ x, y, vx, vy, radius: 8 });
  }

  function updateSoul(){
    soul.dx = 0;
    soul.dy = 0;
    if(keys['arrowleft'] || keys['a']) soul.dx = -soul.speed;
    if(keys['arrowright'] || keys['d']) soul.dx = soul.speed;
    if(keys['arrowup'] || keys['w']) soul.dy = -soul.speed;
    if(keys['arrowdown'] || keys['s']) soul.dy = soul.speed;

    // Normalize diagonal speed so it doesn't get faster
    if(soul.dx !== 0 && soul.dy !== 0){
      soul.dx *= Math.SQRT1_2;
      soul.dy *= Math.SQRT1_2;
    }

    soul.x += soul.dx;
    soul.y += soul.dy;

    // Clamp inside canvas
    soul.x = Math.min(width - soul.radius, Math.max(soul.radius, soul.x));
    soul.y = Math.min(height - soul.radius, Math.max(soul.radius, soul.y));
  }

  function updateBullets(delta){
    bullets.forEach(b => {
      b.x += b.vx;
      b.y += b.vy;
    });

    // Remove bullets that go off screen
    bullets = bullets.filter(b => b.x > -30 && b.x < width + 30 && b.y > -30 && b.y < height + 30);
  }

  function drawSoul(){
    ctx.beginPath();
    ctx.fillStyle = '#e03e3e';
    ctx.shadowColor = '#e03e3e';
    ctx.shadowBlur = 15;
    ctx.arc(soul.x, soul.y, soul.radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;
  }

  function drawBullets(){
    ctx.fillStyle = '#ffffff';
    bullets.forEach(b => {
      ctx.beginPath();
      ctx.shadowColor = '#fff';
      ctx.shadowBlur = 8;
      ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowBlur = 0;
    });
  }

  function checkCollision(){
    for(let b of bullets){
      const dx = b.x - soul.x;
      const dy = b.y - soul.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if(dist < b.radius + soul.radius){
        return true;
      }
    }
    return false;
  }

  function gameLoop(timestamp){
    if(!lastTime) lastTime = timestamp;
    const delta = timestamp - lastTime;
    lastTime = timestamp;

    if(gameOver){
      return;
    }

    // Clear canvas
    ctx.clearRect(0, 0, width, height);

    // Update player
    updateSoul();

    // Spawn bullets faster over time
    if(timestamp - lastSpawn > spawnInterval){
      spawnBullet();
      lastSpawn = timestamp;
      // Make shit harder gradually
      if(spawnInterval > 250) spawnInterval -= 10;
      bulletSpeed += 0.005;
    }

    // Update bullets
    updateBullets(delta);

    // Draw everything
    drawSoul();
    drawBullets();

    // Check collision
    if(checkCollision()){
      gameOver = true;
      gameOverText.style.display = 'block';
      restartBtn.style.display = 'block';
      info.textContent = `You lasted ${(survivalTime / 1000).toFixed(2)} seconds. Not bad, but not good enough!`;
      return;
    }

    survivalTime += delta;

    // Draw survival time
    ctx.fillStyle = '#eee';
    ctx.font = '20px monospace';
    ctx.fillText(`Time: ${(survivalTime / 1000).toFixed(2)}s`, 10, 30);

    requestAnimationFrame(gameLoop);
  }

  resetGame();
</script>

</body>
</html>
