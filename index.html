<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Deltarune Soul Dodge - More Fucking Enemies</title>
<style>
  body {
    margin: 0; 
    background: #111;
    overflow: hidden;
    display: flex; 
    justify-content: center; 
    align-items: center;
    height: 100vh;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
  }
  canvas {
    background: #222;
    border: 4px solid #e03e3e;
    border-radius: 12px;
    display: block;
  }
  #info {
    position: fixed;
    top: 10px; 
    left: 50%;
    transform: translateX(-50%);
    font-size: 18px;
    text-align: center;
    z-index: 10;
  }
  #game-over {
    position: fixed;
    top: 50%; 
    left: 50%;
    transform: translate(-50%, -50%);
    color: #e03e3e;
    font-size: 48px;
    font-weight: bold;
    display: none;
    z-index: 11;
    text-shadow: 0 0 10px #e03e3e;
  }
  #restart-btn {
    position: fixed;
    top: 60%; 
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 24px;
    font-size: 20px;
    cursor: pointer;
    background: #e03e3e;
    border: none;
    border-radius: 8px;
    color: #111;
    display: none;
    z-index: 11;
  }
</style>
</head>
<body>

<div id="info">
  Use arrow keys or WASD to move the soul.<br>
  Dodge the damn bullets for as long as you fucking can!<br>
  Now with fast, big, AND homing bullets. Good luck, asshole.
</div>

<canvas id="game" width="600" height="600"></canvas>

<div id="game-over">YOU FUCKING DIED</div>

<button id="restart-btn">Restart</button>

<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const info = document.getElementById('info');
  const gameOverText = document.getElementById('game-over');
  const restartBtn = document.getElementById('restart-btn');

  const width = canvas.width;
  const height = canvas.height;

  const soul = {
    x: width / 2,
    y: height / 2,
    radius: 15,
    speed: 5,
    dx: 0,
    dy: 0,
  };

  let bullets = [];
  let lastSpawn = 0;
  let spawnInterval = 1000; // ms
  let survivalTime = 0;
  let gameOver = false;

  // Control state
  const keys = {};

  window.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
  });
  window.addEventListener('keyup', e => {
    keys[e.key.toLowerCase()] = false;
  });

  restartBtn.addEventListener('click', () => {
    resetGame();
  });

  // Different bullet types with properties
  // type: 'fast', 'big', 'homing'
  // fast = small, fast bullets
  // big = big, slow bullets
  // homing = medium size, slowly chase you

  function spawnBullet() {
    const edges = ['top', 'right', 'bottom', 'left'];
    const edge = edges[Math.floor(Math.random() * edges.length)];

    // Pick a random bullet type weighted (you can tweak this)
    const types = ['fast', 'fast', 'fast', 'big', 'homing']; 
    const type = types[Math.floor(Math.random() * types.length)];

    let x, y;

    switch(edge){
      case 'top':
        x = Math.random() * width;
        y = -30;
        break;
      case 'right':
        x = width + 30;
        y = Math.random() * height;
        break;
      case 'bottom':
        x = Math.random() * width;
        y = height + 30;
        break;
      case 'left':
        x = -30;
        y = Math.random() * height;
        break;
    }

    let radius, speed, vx, vy;

    if(type === 'fast'){
      radius = 6;
      speed = 5 + survivalTime * 0.001; // speeds up a little over time
      // shoot roughly at soul with randomness
      let targetX = soul.x + (Math.random() * 100 - 50);
      let targetY = soul.y + (Math.random() * 100 - 50);
      const angle = Math.atan2(targetY - y, targetX - x);
      vx = Math.cos(angle) * speed;
      vy = Math.sin(angle) * speed;
    } 
    else if(type === 'big'){
      radius = 14;
      speed = 2 + survivalTime * 0.0005; // slow and heavy
      let targetX = soul.x + (Math.random() * 200 - 100);
      let targetY = soul.y + (Math.random() * 200 - 100);
      const angle = Math.atan2(targetY - y, targetX - x);
      vx = Math.cos(angle) * speed;
      vy = Math.sin(angle) * speed;
    } 
    else if(type === 'homing'){
      radius = 10;
      speed = 3 + survivalTime * 0.0007; // medium speed homing bullet
      // homing bullets get their velocity updated every frame, start with zero velocity for now
      vx = 0;
      vy = 0;
    }

    bullets.push({ x, y, vx, vy, radius, type, speed });
  }

  function updateSoul(){
    soul.dx = 0;
    soul.dy = 0;
    if(keys['arrowleft'] || keys['a']) soul.dx = -soul.speed;
    if(keys['arrowright'] || keys['d']) soul.dx = soul.speed;
    if(keys['arrowup'] || keys['w']) soul.dy = -soul.speed;
    if(keys['arrowdown'] || keys['s']) soul.dy = soul.speed;

    if(soul.dx !== 0 && soul.dy !== 0){
      soul.dx *= Math.SQRT1_2;
      soul.dy *= Math.SQRT1_2;
    }

    soul.x += soul.dx;
    soul.y += soul.dy;

    soul.x = Math.min(width - soul.radius, Math.max(soul.radius, soul.x));
    soul.y = Math.min(height - soul.radius, Math.max(soul.radius, soul.y));
  }

  function updateBullets(delta){
    bullets.forEach(b => {
      if(b.type === 'homing'){
        // Update velocity toward soul
        const angle = Math.atan2(soul.y - b.y, soul.x - b.x);
        b.vx = Math.cos(angle) * b.speed;
        b.vy = Math.sin(angle) * b.speed;
      }
      b.x += b.vx;
      b.y += b.vy;
    });

    bullets = bullets.filter(b => b.x > -50 && b.x < width + 50 && b.y > -50 && b.y < height + 50);
  }

  function drawSoul(){
    ctx.beginPath();
    ctx.fillStyle = '#e03e3e';
    ctx.shadowColor = '#e03e3e';
    ctx.shadowBlur = 15;
    ctx.arc(soul.x, soul.y, soul.radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;
  }

  function drawBullets(){
    bullets.forEach(b => {
      ctx.beginPath();
      if(b.type === 'fast') {
        ctx.fillStyle = '#fff';
        ctx.shadowColor = '#fff';
        ctx.shadowBlur = 8;
      } else if(b.type === 'big'){
        ctx.fillStyle = '#ff5555';
        ctx.shadowColor = '#ff5555';
        ctx.shadowBlur = 12;
      } else if(b.type === 'homing'){
        ctx.fillStyle = '#55ffff';
        ctx.shadowColor = '#55ffff';
        ctx.shadowBlur = 12;
      }
      ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowBlur = 0;
    });
  }

  function checkCollision(){
    for(let b of bullets){
      const dx = b.x - soul.x;
      const dy = b.y - soul.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if(dist < b.radius + soul.radius){
        return true;
      }
    }
    return false;
  }

  function gameLoop(timestamp){
    if(!lastTime) lastTime = timestamp;
    const delta = timestamp - lastTime;
    lastTime = timestamp;

    if(gameOver) return;

    ctx.clearRect(0, 0, width, height);

    updateSoul();

    if(timestamp - lastSpawn > spawnInterval){
      spawnBullet();
      lastSpawn = timestamp;
      // Make shit harder gradually
      if(spawnInterval > 250) spawnInterval -= 10;
      survivalTime += delta;
    }

    updateBullets(delta);

    drawSoul();
    drawBullets();

    if(checkCollision()){
      gameOver = true;
      gameOverText.style.display = 'block';
      restartBtn.style.display = 'block';
      info.textContent = `You lasted ${(survivalTime / 1000).toFixed(2)} seconds. Not bad, but not good enough!`;
      return;
    }

    ctx.fillStyle = '#eee';
    ctx.font = '20px monospace';
    ctx.fillText(`Time: ${(survivalTime / 1000).toFixed(2)}s`, 10, 30);

    requestAnimationFrame(gameLoop);
  }

  function resetGame(){
    gameOver = false;
    bullets = [];
    soul.x = width / 2;
    soul.y = height / 2;
    survivalTime = 0;
    spawnInterval = 1000;
    lastSpawn = 0;
    lastTime = performance.now();
    gameOverText.style.display = 'none';
    restartBtn.style.display = 'none';
    info.textContent = 'Use arrow keys or WASD to move the soul. Dodge the damn bullets for as long as you fucking can! Now with fast, big, AND homing bullets. Good luck, asshole.';
    requestAnimationFrame(gameLoop);
  }

  let lastTime = 0;
  resetGame();
</script>

</body>
</html>
