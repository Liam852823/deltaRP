<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Deltarune-ish Battle with Bones & Gaster Blasters</title>
<style>
  body {
    margin: 0; 
    background: #111;
    overflow: hidden;
    display: flex; 
    justify-content: center; 
    align-items: center;
    height: 100vh;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
  }
  canvas {
    background: #222;
    border: 4px solid #e03e3e;
    border-radius: 12px;
    display: block;
  }
  #info {
    position: fixed;
    top: 10px; 
    left: 50%;
    transform: translateX(-50%);
    font-size: 18px;
    text-align: center;
    z-index: 10;
  }
  #game-over {
    position: fixed;
    top: 50%; 
    left: 50%;
    transform: translate(-50%, -50%);
    color: #e03e3e;
    font-size: 48px;
    font-weight: bold;
    display: none;
    z-index: 11;
    text-shadow: 0 0 10px #e03e3e;
  }
  #restart-btn {
    position: fixed;
    top: 60%; 
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 24px;
    font-size: 20px;
    cursor: pointer;
    background: #e03e3e;
    border: none;
    border-radius: 8px;
    color: #111;
    display: none;
    z-index: 11;
  }
  #attack-btn {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 36px;
    font-size: 22px;
    cursor: pointer;
    background: #55cc55;
    border: none;
    border-radius: 10px;
    color: #111;
    display: none;
    z-index: 12;
    user-select: none;
  }
</style>
</head>
<body>

<div id="info">
  Use arrow keys or WASD to move the soul.<br>
  Dodge bullets, bones, and lasers.<br>
  Survive attack phases, then hit "ATTACK" to fuck up the enemy.<br>
  You have <span id="hp">3</span> HP.<br>
</div>

<canvas id="game" width="600" height="600"></canvas>

<div id="game-over">YOU FUCKING DIED</div>
<button id="restart-btn">Restart</button>
<button id="attack-btn">ATTACK</button>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const info = document.getElementById('info');
const hpSpan = document.getElementById('hp');
const gameOverText = document.getElementById('game-over');
const restartBtn = document.getElementById('restart-btn');
const attackBtn = document.getElementById('attack-btn');

const width = canvas.width;
const height = canvas.height;

const soul = {
  x: width / 2,
  y: height / 2,
  radius: 15,
  speed: 5,
  dx: 0,
  dy: 0,
  hp: 3,
  invincibleTimer: 0,
};

let bullets = [];
let bones = [];
let gasterBlasters = [];

let lastSpawn = 0;
let spawnInterval = 600;
let survivalTime = 0;
let gameOver = false;

// Attack phases including new bone and gaster attacks
const phases = ['fast', 'big', 'homing', 'bone', 'gaster'];
let currentPhase = 0;
let phaseDuration = 8000; // ms per phase
let phaseTimer = 0;
let canAttack = false;
let enemyHp = 5;

const keys = {};
window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

restartBtn.addEventListener('click', resetGame);
attackBtn.addEventListener('click', () => {
  if(canAttack){
    enemyHp--;
    canAttack = false;
    attackBtn.style.display = 'none';
    info.textContent = `You attacked the enemy! Enemy HP: ${enemyHp}`;
    if(enemyHp <= 0){
      info.textContent = 'YOU FUCKING WON! Restart to play again.';
      gameOver = true;
      attackBtn.style.display = 'none';
    } else {
      setTimeout(() => startNextPhase(), 1500);
    }
  }
});

// Bullet constructor (fast, big, homing)
class Bullet {
  constructor(x, y, vx, vy, radius, type, speed){
    this.x = x;
    this.y = y;
    this.vx = vx;
    this.vy = vy;
    this.radius = radius;
    this.type = type;
    this.speed = speed;
    this.homingTime = 0;
    this.originalDir = { vx, vy };
    this.bounced = false;
  }
  update(delta){
    if(this.type === 'homing'){
      this.homingTime += delta;
      if(this.homingTime < 1000 + Math.random() * 1000){
        const angle = Math.atan2(soul.y - this.y, soul.x - this.x);
        this.vx = Math.cos(angle) * this.speed;
        this.vy = Math.sin(angle) * this.speed;
      } else if(!this.bounced){
        this.vx = this.originalDir.vx;
        this.vy = this.originalDir.vy;
        this.bounced = true;
      }
    }
    this.x += this.vx;
    this.y += this.vy;
  }
  draw(ctx){
    ctx.beginPath();
    if(this.type === 'fast') {
      ctx.fillStyle = '#fff';
      ctx.shadowColor = '#fff';
      ctx.shadowBlur = 8;
    } else if(this.type === 'big'){
      ctx.fillStyle = '#ff5555';
      ctx.shadowColor = '#ff5555';
      ctx.shadowBlur = 12;
    } else if(this.type === 'homing'){
      ctx.fillStyle = '#55ffff';
      ctx.shadowColor = '#55ffff';
      ctx.shadowBlur = 12;
    }
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;
  }
  isOffscreen(){
    return this.x < -50 || this.x > width + 50 || this.y < -50 || this.y > height + 50;
  }
}

// Bone constructor (shoots horizontally or vertically)
class Bone {
  constructor(x, y, vx, vy){
    this.x = x;
    this.y = y;
    this.vx = vx;
    this.vy = vy;
    this.width = 40;
    this.height = 10;
    this.hitboxRadius = 10;
  }
  update(){
    this.x += this.vx;
    this.y += this.vy;
  }
  draw(ctx){
    ctx.fillStyle = '#ffffff';
    ctx.shadowColor = '#fff';
    ctx.shadowBlur = 8;
    ctx.fillRect(this.x - this.width/2, this.y - this.height/2, this.width, this.height);
    ctx.shadowBlur = 0;
  }
  isOffscreen(){
    return this.x < -50 || this.x > width + 50 || this.y < -50 || this.y > height + 50;
  }
  collidesWithSoul(){
    // Circle-rect collision approximation
    let distX = Math.abs(soul.x - this.x);
    let distY = Math.abs(soul.y - this.y);
    if(distX > (this.width/2 + soul.radius)) return false;
    if(distY > (this.height/2 + soul.radius)) return false;
    if(distX <= (this.width/2)) return true;
    if(distY <= (this.height/2)) return true;
    let dx = distX - this.width/2;
    let dy = distY - this.height/2;
    return (dx*dx + dy*dy <= soul.radius * soul.radius);
  }
}

// Gaster Blaster constructor
class GasterBlaster {
  constructor(x, y, angle){
    this.x = x;
    this.y = y;
    this.angle = angle;
    this.chargeTime = 2000; // ms charging
    this.fireTime = 1500; // ms firing laser
    this.timer = 0;
    this.state = 'charging'; // charging, firing, done
  }
  update(delta){
    this.timer += delta;
    if(this.state === 'charging' && this.timer >= this.chargeTime){
      this.state = 'firing';
      this.timer = 0;
    } else if(this.state === 'firing' && this.timer >= this.fireTime){
      this.state = 'done';
    }
  }
  draw(ctx){
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.angle);
    // Draw skull
    ctx.fillStyle = '#eee';
    ctx.shadowColor = '#eee';
    ctx.shadowBlur = 10;
    ctx.beginPath();
    ctx.ellipse(0, 0, 40, 20, 0, 0, Math.PI * 2);
    ctx.fill();
    // Eyes
    ctx.fillStyle = '#e03e3e';
    ctx.beginPath();
    ctx.ellipse(-15, -5, 6, 6, 0, 0, Math.PI * 2);
    ctx.ellipse(15, -5, 6, 6, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();

    // Draw laser beam if firing
    if(this.state === 'firing'){
      ctx.save();
      ctx.translate(this.x, this.y);
      ctx.rotate(this.angle);
      ctx.fillStyle = 'rgba(255, 0, 0, 0.6)';
      ctx.shadowColor = 'rgba(255,0,0,0.8)';
      ctx.shadowBlur = 20;
      ctx.fillRect(40, -10, width, 20);
      ctx.restore();
    } else if(this.state === 'charging'){
      // Draw warning line
      ctx.save();
      ctx.translate(this.x, this.y);
      ctx.rotate(this.angle);
      ctx.strokeStyle = 'rgba(255, 0, 0, 0.4)';
      ctx.lineWidth = 8;
      ctx.setLine
```

